From af6621ffcb65d5c647e514977745fced3b851cb6 Mon Sep 17 00:00:00 2001
From: "K.Takata" <kentkt@csc.jp>
Date: Mon, 1 Oct 2018 07:05:35 +0900
Subject: [PATCH 08/28] dosinst: Adjust the default _vimrc

Don't set 'diffexpr' if the internal diff is supported.
---
 src/dosinst.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/dosinst.c b/src/dosinst.c
index 1c96305a9..d9405b577 100644
--- a/src/dosinst.c
+++ b/src/dosinst.c
@@ -1192,7 +1192,9 @@ install_vimrc(int idx)
 	/* Use the diff.exe that comes with the self-extracting gvim.exe. */
 	fclose(tfd);
 	fprintf(fd, "\n");
-	fprintf(fd, "set diffexpr=MyDiff()\n");
+	fprintf(fd, "if &diffopt !~# 'internal'\n");
+	fprintf(fd, "  set diffexpr=MyDiff()\n");
+	fprintf(fd, "endif\n");
 	fprintf(fd, "function MyDiff()\n");
 	fprintf(fd, "  let opt = '-a --binary '\n");
 	fprintf(fd, "  if &diffopt =~ 'icase' | let opt = opt . '-i ' | endif\n");
-- 
2.17.0

